syntax = "proto3";

package mediadelivery;

option go_package = "github.com/kkiling/media-delivery/api";

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "media-delivery/common-model.proto";
import "media-delivery/video-content-model.proto";
import "media-delivery/tv-show-delivery-state.proto";
import "media-delivery/tv-show-delete-state.proto";

service VideoContentService {
  rpc CreateVideoContent(CreateVideoContentRequest) returns (CreateVideoContentResponse) {
    option (google.api.http) = {
      post: "/v1/content";
      body: "*";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Создание видео контента";
    };
  };
  rpc GetVideoContent(GetVideoContentRequest) returns (GetVideoContentResponse) {
    option (google.api.http) = {
      get: "/v1/content";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Получение видео контента для кино/тв сериала"
    };
  };
  // Информация о доставки файлов videoContent
  rpc CreateDeliveryState(CreateDeliveryStateRequest) returns (CreateDeliveryStateResponse) {
    option (google.api.http) = {
      post: "/v1/content/delivery";
      body: "*";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Создание доставки видео контента";
    };
  };
  rpc GetDeliveryData(GetDeliveryDataRequest) returns (GetDeliveryDataResponse) {
    option (google.api.http) = {
      get: "/v1/content/delivery/data";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Получение данных стейта доставки видеоконтента"
    };
  };
  rpc ChoseTorrentOptions(ChoseTorrentOptionsRequest) returns (ChoseTorrentOptionsResponse) {
    option (google.api.http) = {
      patch: "/v1/content/delivery/chose-torrent";
      body: "*";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Выбор раздачи с торрента"
    };
  };
  rpc ChoseFileMatchesOptions(ChoseFileMatchesOptionsRequest) returns (ChoseFileMatchesOptionsResponse) {
    option (google.api.http) = {
      patch: "/v1/content/delivery/chose-file-matches";
      body: "*";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Подтверждение метча файлов"
    };
  };
  // Удаление файлов videoContent
  rpc DeleteVideoContentFiles(DeleteVideoContentFilesRequest) returns (DeleteVideoContentFilesResponse) {
    option (google.api.http) = {
      delete: "/v1/content/delivery";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Удаление файлов видеоконтента"
    };
  };
}

message CreateVideoContentRequest {
  ContentID content_id = 1;
}

message CreateVideoContentResponse {
  VideoContent result = 1;
}

message GetVideoContentRequest {
  ContentID content_id = 1;
}

message GetVideoContentResponse {
  repeated VideoContent items = 1;
}

message CreateDeliveryStateRequest {
  ContentID content_id = 1;
}

message CreateDeliveryStateResponse {
  TVShowDeliveryState result = 1;
}

message GetDeliveryDataRequest {
  ContentID content_id = 1;
}

message GetDeliveryDataResponse {
  TVShowDeliveryState result = 1;
}

message ChoseTorrentOptionsRequest {
  ContentID content_id = 1;
  // Пользователь выбрал конкретный торрента файл
  optional string href = 2;
  // Пользователь поменял поисковый запрос
  optional string new_search_query = 3;
}

message ChoseTorrentOptionsResponse {
  TVShowDeliveryState result = 1;
}

message ChoseFileMatchesOptionsResponse {
  TVShowDeliveryState result = 1;
}

message DeleteVideoContentFilesRequest {
  ContentID content_id = 1;
}

message DeleteVideoContentFilesResponse {
    TVShowDeleteState result = 1;
}