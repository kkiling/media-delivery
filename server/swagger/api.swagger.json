{
  "swagger": "2.0",
  "info": {
    "title": "Media delivery API",
    "version": "0.1"
  },
  "tags": [
    {
      "name": "TVShowLibraryService"
    },
    {
      "name": "VideoContentService"
    }
  ],
  "schemes": [
    "http"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/content": {
      "get": {
        "summary": "Получение доставок для кино/тв сериала",
        "operationId": "VideoContentService_GetVideoContent",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/GetVideoContentResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "content_id.movie_id",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "uint64"
          },
          {
            "name": "content_id.tv_show.id",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "uint64"
          },
          {
            "name": "content_id.tv_show.season_number",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int64"
          }
        ],
        "tags": [
          "VideoContentService"
        ]
      },
      "post": {
        "summary": "Создание файловой раздачи",
        "operationId": "VideoContentService_CreateVideoContent",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/CreateVideoContentResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CreateVideoContentRequest"
            }
          }
        ],
        "tags": [
          "VideoContentService"
        ]
      }
    },
    "/v1/tvshow/delivery/chose-file-matches": {
      "patch": {
        "summary": "Подтверждение метча файлов",
        "operationId": "VideoContentService_ChoseFileMatchesOptions",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/ChoseFileMatchesOptionsResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/ChoseFileMatchesOptionsRequest"
            }
          }
        ],
        "tags": [
          "VideoContentService"
        ]
      }
    },
    "/v1/tvshow/delivery/chose-torrent": {
      "patch": {
        "summary": "Выбор раздачи с торрента",
        "operationId": "VideoContentService_ChoseTorrentOptions",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/ChoseTorrentOptionsResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/ChoseTorrentOptionsRequest"
            }
          }
        ],
        "tags": [
          "VideoContentService"
        ]
      }
    },
    "/v1/tvshow/delivery/data": {
      "get": {
        "summary": "Получение данных стейта доставки",
        "operationId": "VideoContentService_GetTVShowDeliveryData",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/GetTVShowDeliveryDataResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "content_id.movie_id",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "uint64"
          },
          {
            "name": "content_id.tv_show.id",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "uint64"
          },
          {
            "name": "content_id.tv_show.season_number",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int64"
          }
        ],
        "tags": [
          "VideoContentService"
        ]
      }
    },
    "/v1/tvshow/info/{tv_show_id}": {
      "get": {
        "summary": "Получение подробной информации о сериале",
        "operationId": "TVShowLibraryService_GetTVShowInfo",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/GetTVShowInfoResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "tv_show_id",
            "in": "path",
            "required": true,
            "type": "string",
            "format": "uint64"
          }
        ],
        "tags": [
          "TVShowLibraryService"
        ]
      }
    },
    "/v1/tvshow/info/{tv_show_id}/{season_number}": {
      "get": {
        "summary": "Получение информации о сезоне сериала и его сериях",
        "operationId": "TVShowLibraryService_GetSeasonInfo",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/GetSeasonInfoResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "tv_show_id",
            "in": "path",
            "required": true,
            "type": "string",
            "format": "uint64"
          },
          {
            "name": "season_number",
            "in": "path",
            "required": true,
            "type": "integer",
            "format": "int64"
          }
        ],
        "tags": [
          "TVShowLibraryService"
        ]
      }
    },
    "/v1/tvshow/library": {
      "get": {
        "summary": "Получение списка сериалов из библиотеки",
        "operationId": "TVShowLibraryService_GetTVShowsFromLibrary",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/GetTVShowsFromLibraryResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "tags": [
          "TVShowLibraryService"
        ]
      }
    },
    "/v1/tvshow/search": {
      "get": {
        "summary": "Поиск сериалов по названию",
        "operationId": "TVShowLibraryService_SearchTVShow",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/SearchTVShowResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": false,
            "type": "string"
          }
        ],
        "tags": [
          "TVShowLibraryService"
        ]
      }
    }
  },
  "definitions": {
    "Any": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "ChoseFileMatchesOptionsRequest": {
      "type": "object",
      "properties": {
        "content_id": {
          "$ref": "#/definitions/ContentID"
        },
        "approve": {
          "type": "boolean",
          "title": "Пользователь подтверждает сметченные файлы"
        }
      }
    },
    "ChoseFileMatchesOptionsResponse": {
      "type": "object",
      "properties": {
        "result": {
          "$ref": "#/definitions/TVShowDeliveryState"
        }
      }
    },
    "ChoseTorrentOptionsRequest": {
      "type": "object",
      "properties": {
        "content_id": {
          "$ref": "#/definitions/ContentID"
        },
        "href": {
          "type": "string",
          "title": "Пользователь выбрал конкретный торрента файл"
        },
        "new_search_query": {
          "type": "string",
          "title": "Пользователь поменял поисковый запрос"
        }
      }
    },
    "ChoseTorrentOptionsResponse": {
      "type": "object",
      "properties": {
        "result": {
          "$ref": "#/definitions/TVShowDeliveryState"
        }
      }
    },
    "ContentID": {
      "type": "object",
      "properties": {
        "movie_id": {
          "type": "integer",
          "format": "uint64"
        },
        "tv_show": {
          "$ref": "#/definitions/TVShowID"
        }
      }
    },
    "ContentMatches": {
      "type": "object",
      "properties": {
        "episode": {
          "$ref": "#/definitions/EpisodeInfo"
        },
        "video": {
          "$ref": "#/definitions/VideoFile"
        },
        "audio_files": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/Track"
          }
        },
        "subtitles": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/Track"
          }
        }
      }
    },
    "CreateVideoContentRequest": {
      "type": "object",
      "properties": {
        "content_id": {
          "$ref": "#/definitions/ContentID"
        }
      }
    },
    "CreateVideoContentResponse": {
      "type": "object",
      "properties": {
        "result": {
          "$ref": "#/definitions/VideoContent"
        }
      }
    },
    "DeliveryStatus": {
      "type": "string",
      "enum": [
        "DeliveryStatusUnknown",
        "DeliveryStatusFailed",
        "DeliveryStatusInProgress",
        "DeliveryStatusDelivered"
      ],
      "default": "DeliveryStatusUnknown"
    },
    "Episode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "format": "uint64"
        },
        "air_date": {
          "type": "string",
          "format": "date-time"
        },
        "episode_number": {
          "type": "integer",
          "format": "int64"
        },
        "episode_type": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "overview": {
          "type": "string"
        },
        "runtime": {
          "type": "integer",
          "format": "int64"
        },
        "still": {
          "$ref": "#/definitions/Image"
        },
        "vote_average": {
          "type": "number",
          "format": "float"
        },
        "vote_count": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "EpisodeInfo": {
      "type": "object",
      "properties": {
        "season_number": {
          "type": "integer",
          "format": "int64"
        },
        "episode_name": {
          "type": "string"
        },
        "episode_number": {
          "type": "integer",
          "format": "int64"
        },
        "file_name": {
          "type": "string"
        },
        "relative_path": {
          "type": "string"
        }
      }
    },
    "ErrorType": {
      "type": "string",
      "enum": [
        "TVShowDeliveryError_Unknown",
        "TorrentSiteForbidden",
        "FilesAlreadyExist"
      ],
      "default": "TVShowDeliveryError_Unknown",
      "title": "- TorrentSiteForbidden: Торрент трекер не доступен\n - FilesAlreadyExist: Файлы на медиасервере уже существуют"
    },
    "FileInfo": {
      "type": "object",
      "properties": {
        "relative_path": {
          "type": "string"
        },
        "full_path": {
          "type": "string"
        },
        "size": {
          "type": "string",
          "format": "int64"
        },
        "extension": {
          "type": "string"
        }
      }
    },
    "GetSeasonInfoResponse": {
      "type": "object",
      "properties": {
        "season": {
          "$ref": "#/definitions/Season"
        },
        "episodes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/Episode"
          }
        }
      }
    },
    "GetTVShowDeliveryDataResponse": {
      "type": "object",
      "properties": {
        "result": {
          "$ref": "#/definitions/TVShowDeliveryState"
        }
      }
    },
    "GetTVShowInfoResponse": {
      "type": "object",
      "properties": {
        "result": {
          "$ref": "#/definitions/TVShow"
        }
      }
    },
    "GetTVShowsFromLibraryResponse": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/TVShowShort"
          }
        }
      }
    },
    "GetVideoContentResponse": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/VideoContent"
          }
        }
      }
    },
    "Image": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "w92": {
          "type": "string"
        },
        "w185": {
          "type": "string",
          "title": "string w154 = 3;"
        },
        "w342": {
          "type": "string"
        },
        "original": {
          "type": "string",
          "title": "string w500 = 6;\nstring w780 = 7;"
        }
      }
    },
    "MergeVideoStatus": {
      "type": "object",
      "properties": {
        "progress": {
          "type": "number",
          "format": "float"
        },
        "is_complete": {
          "type": "boolean"
        }
      }
    },
    "SearchQuery": {
      "type": "object",
      "properties": {
        "Query": {
          "type": "string"
        }
      }
    },
    "SearchTVShowResponse": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/TVShowShort"
          }
        }
      }
    },
    "Season": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "format": "uint64"
        },
        "air_date": {
          "type": "string",
          "format": "date-time"
        },
        "episode_count": {
          "type": "integer",
          "format": "int64"
        },
        "name": {
          "type": "string"
        },
        "overview": {
          "type": "string"
        },
        "poster": {
          "$ref": "#/definitions/Image"
        },
        "season_number": {
          "type": "integer",
          "format": "int64"
        },
        "vote_average": {
          "type": "number",
          "format": "float"
        }
      }
    },
    "TVShow": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "format": "uint64"
        },
        "name": {
          "type": "string"
        },
        "original_name": {
          "type": "string"
        },
        "overview": {
          "type": "string"
        },
        "poster": {
          "$ref": "#/definitions/Image"
        },
        "first_air_date": {
          "type": "string",
          "format": "date-time"
        },
        "vote_average": {
          "type": "number",
          "format": "float"
        },
        "vote_count": {
          "type": "integer",
          "format": "int64"
        },
        "popularity": {
          "type": "number",
          "format": "float"
        },
        "backdrop": {
          "$ref": "#/definitions/Image"
        },
        "genres": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "last_air_date": {
          "type": "string",
          "format": "date-time"
        },
        "number_of_episodes": {
          "type": "integer",
          "format": "int64"
        },
        "number_of_seasons": {
          "type": "integer",
          "format": "int64"
        },
        "origin_country": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string"
        },
        "tagline": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "seasons": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/Season"
          }
        }
      }
    },
    "TVShowCatalog": {
      "type": "object",
      "properties": {
        "torrent_path": {
          "type": "string",
          "title": "Путь до раздачи сезона сериала"
        },
        "torrent_size_pretty": {
          "type": "string",
          "title": "Размер файлов раздачи сезона сериала"
        },
        "media_server_path": {
          "$ref": "#/definitions/TVShowCatalogPath",
          "title": "Путь до сезона сериала на медиасервере"
        },
        "media_server_size_pretty": {
          "type": "string",
          "title": "Размер файлов раздачи сезона сериала (байты)"
        },
        "is_copy_files_in_media_server": {
          "type": "boolean",
          "title": "Файлы скопированы с раздачи или созданы ссылочная связь\nTrue - файлы скопированы\nFalse - файлы созданы через линки"
        }
      }
    },
    "TVShowCatalogPath": {
      "type": "object",
      "properties": {
        "tv_show_path": {
          "type": "string",
          "title": "Путь до каталога сериала"
        },
        "season_path": {
          "type": "string",
          "title": "Путь до каталога сезона (относительно каталога сериала)"
        }
      }
    },
    "TVShowDeliveryData": {
      "type": "object",
      "properties": {
        "search_query": {
          "$ref": "#/definitions/SearchQuery",
          "title": "Поисковый запрос поиска торрент файла"
        },
        "torrent_search": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/TorrentSearch"
          },
          "title": "Результат поиска торрент раздач"
        },
        "content_matches": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/ContentMatches"
          },
          "title": "Результат метча файлов"
        },
        "torrent_download_status": {
          "$ref": "#/definitions/TorrentDownloadStatus",
          "title": "статус скачивания раздачи"
        },
        "merge_video_status": {
          "$ref": "#/definitions/MergeVideoStatus",
          "title": "статус сшивания файлов"
        },
        "tv_show_catalog_info": {
          "$ref": "#/definitions/TVShowCatalog",
          "title": "TVShowCatalogInfo информация о каталогах сериала"
        },
        "torrent": {
          "$ref": "#/definitions/Torrent",
          "title": "Информация о раздаче"
        }
      }
    },
    "TVShowDeliveryError": {
      "type": "object",
      "properties": {
        "raw_error": {
          "type": "string"
        },
        "error_type": {
          "$ref": "#/definitions/ErrorType"
        }
      }
    },
    "TVShowDeliveryState": {
      "type": "object",
      "properties": {
        "data": {
          "$ref": "#/definitions/TVShowDeliveryData"
        },
        "step": {
          "$ref": "#/definitions/TVShowDeliveryStatus"
        },
        "status": {
          "$ref": "#/definitions/mediadelivery.Status"
        },
        "error": {
          "$ref": "#/definitions/TVShowDeliveryError"
        }
      }
    },
    "TVShowDeliveryStatus": {
      "type": "string",
      "enum": [
        "TVShowDeliveryStatusUnknown",
        "GenerateSearchQuery",
        "SearchTorrents",
        "WaitingUserChoseTorrent",
        "GetMagnetLink",
        "AddTorrentToTorrentClient",
        "PrepareFileMatches",
        "WaitingChoseFileMatches",
        "WaitingTorrentDownloadComplete",
        "CreateVideoContentCatalogs",
        "DeterminingNeedConvertFiles",
        "StartMergeVideoFiles",
        "WaitingMergeVideoFiles",
        "CreateHardLinkCopy",
        "GetCatalogsSize",
        "SetMediaMetaData",
        "SendDeliveryNotification",
        "WaitingTorrentFiles",
        "GetEpisodesData"
      ],
      "default": "TVShowDeliveryStatusUnknown",
      "title": "- TVShowDeliveryStatusUnknown: Неизвестный статус доставки\n - GenerateSearchQuery: Генерация запроса к трекеру\n - SearchTorrents: Поиск раздач сезона сериала/фильма\n - WaitingUserChoseTorrent: Ожидание выбора раздачи пользователем\n - GetMagnetLink: Получение магнет ссылки\n - AddTorrentToTorrentClient: Добавление раздачи для скачивания торрент клиентом\n - PrepareFileMatches: Получение информации о файлах раздачи\n - WaitingChoseFileMatches: Ожидание подтверждения пользователем соответствий выбора файлов\n - WaitingTorrentDownloadComplete: Ожидание завершения окончания скачивания раздачи\n - CreateVideoContentCatalogs: Формирование каталогов и иерархии файлов\n - DeterminingNeedConvertFiles: Определение необходимости конвертации файлов\n - StartMergeVideoFiles: Запуск конвертирования файлов\n - WaitingMergeVideoFiles: Ожидание завершения конвертации файлов\n - CreateHardLinkCopy: Копирование файлов из раздачи в каталог медиасервера (точнее создание симлинков)\n - GetCatalogsSize: GetCatalogsSize получение размеров каталогов сериала\n - SetMediaMetaData: Установка методаных серий сезона сериала/фильма в медиасервере\n - SendDeliveryNotification: Отправка уведомления в telegramm о успешной доставки\n - WaitingTorrentFiles: Ожидание когда появится информация о файлах в раздаче\n - GetEpisodesData: получение информации о эпизодах и каталоге сезона"
    },
    "TVShowID": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "format": "uint64"
        },
        "season_number": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "TVShowShort": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "format": "uint64"
        },
        "name": {
          "type": "string"
        },
        "original_name": {
          "type": "string"
        },
        "overview": {
          "type": "string"
        },
        "poster": {
          "$ref": "#/definitions/Image"
        },
        "first_air_date": {
          "type": "string",
          "format": "date-time"
        },
        "vote_average": {
          "type": "number",
          "format": "float"
        },
        "vote_count": {
          "type": "integer",
          "format": "int64"
        },
        "popularity": {
          "type": "number",
          "format": "float"
        }
      }
    },
    "Torrent": {
      "type": "object",
      "properties": {
        "href": {
          "type": "string",
          "title": "Ссылка на раздачу"
        }
      }
    },
    "TorrentDownloadStatus": {
      "type": "object",
      "properties": {
        "state": {
          "$ref": "#/definitions/TorrentState"
        },
        "progress": {
          "type": "number",
          "format": "float"
        },
        "is_complete": {
          "type": "boolean"
        }
      }
    },
    "TorrentSearch": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string"
        },
        "href": {
          "type": "string"
        },
        "category": {
          "type": "string"
        },
        "size": {
          "type": "string"
        },
        "seeds": {
          "type": "string",
          "format": "int64"
        },
        "leeches": {
          "type": "string",
          "format": "int64"
        },
        "downloads": {
          "type": "string",
          "format": "int64"
        },
        "added_date": {
          "type": "string"
        }
      }
    },
    "TorrentState": {
      "type": "string",
      "enum": [
        "TORRENT_STATE_UNKNOWN",
        "TORRENT_STATE_ERROR",
        "TORRENT_STATE_UPLOADING",
        "TORRENT_STATE_DOWNLOADING",
        "TORRENT_STATE_STOPPED",
        "TORRENT_STATE_QUEUED"
      ],
      "default": "TORRENT_STATE_UNKNOWN"
    },
    "Track": {
      "type": "object",
      "properties": {
        "file": {
          "$ref": "#/definitions/FileInfo"
        },
        "name": {
          "type": "string"
        },
        "language": {
          "type": "string"
        }
      }
    },
    "VideoContent": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "delivery_status": {
          "$ref": "#/definitions/DeliveryStatus"
        }
      }
    },
    "VideoFile": {
      "type": "object",
      "properties": {
        "file": {
          "$ref": "#/definitions/FileInfo"
        }
      }
    },
    "mediadelivery.Status": {
      "type": "string",
      "enum": [
        "StatusUnknown",
        "NewStatus",
        "InProgressStatus",
        "CompletedStatus",
        "FailedStatus"
      ],
      "default": "StatusUnknown"
    },
    "rpc.Status": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/Any"
          }
        }
      }
    }
  }
}
